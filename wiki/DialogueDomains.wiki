#summary Encoding rule-structured dialogue domains in XML.

= Dialogue domains =

This section details how to practically encode dialogue domains for !OpenDial using XML.

== 1. General structure ==

A !OpenDial dialogue domain follows the skeleton below:
{{{
<domain>

  <initialstate>
    <!--(optional) initial state variables -->
  </initialstate>

  <parameters>
    <!--(optional) prior distributions for rule parameters -->
  </parameters>

  <model trigger="trigger variables for model 1">
    <!--probabilistic rules for model 1 -->
  </model>

  <model trigger="trigger variables for model 2">
    <!-- probabilistic rules for model 2 -->
  </model>

  ... 

  <model trigger="trigger variables for model n">
    <!-- probabilistic rules for model n -->
  </model>


  <settings>
    <!--(optional) domain-specific settings -->
  </settings>

</domain>

}}}

The settings, initial state and parameters can be left out of the domain specification if empty.  The number of rule-structured models is arbitrary.

For more complex domains, the domain specification can be split in several files through the `import`marker: 
{{{
    <import href="path to another file" />
}}}

Examples of domain specification can be found in the directory `domains` and `test/domains` of the base directory.

<br>

== 2. Initial state ==

The initial state for the domain defines the variables included in the dialogue state upon starting the dialogue system. Each variable has a particular identifier and a probability distribution.

Variables with a discrete range of values are defined in this manner:
{{{
<variable id="variable_id">
  <value prob="probability for first value">first value</value>
  <value prob="probability for second value">second value</value>
  ...
  <value prob="probability for the nth value">nth value</value>
</variable>
}}}

Probability values must be comprised between 0 and 1.  If the total probability amounts to less than 1, !OpenDial automatically adds an empty value (`None`) for the remaining probability mass.  If the `prob` attribute is omitted, the value is assumed to have a probability 1. 

Here is a simple example of initial state variable:
{{{
<variable id="userIntention">
  <value prob="0.5">Want(Object_A)</value>
  <value prob="0.3">Want(Object_B)</value>
</variable>
}}}

Probability distributions can also be defined for a continuous range, as explained below. 

== 3. Parameters ==

As shall be explained in the next section, probabilistic rules can include parameters whose values is initially unknown and must be estimated from data. Since !OpenDial adopts a Bayesian approach to parameter estimation, each parameter must be associated with an prior distribution over its (usually continuous) range of values.

Parameters are defined in exactly the same way as state variables. Their distributions are defined in a parametric manner: 

 * *Uniform distributions* are defined with two parameters `min` and `max`.  The distribution _U(-1,3)_ is thus encoded as:
{{{
<variable id="uniform_example">
  <distrib type="uniform">
    <min>-1</min>
    <max>3</max>
  </distrib>
</variable>
}}}

 * *Gaussian distributions*`[1]` are defined with two parameters `mean` and `variance` -- for instance, _N(2,4)_ is encoded as:
{{{
<variable id="gaussian_example">
  <distrib type="gaussian">
    <mean>-1</mean>
    <variance>3</variance>
  </distrib>
</variable>
}}}

 * *Dirichlet distributions*.  A Dirichlet distribution is a multivariate continuous distribution.  It is often employed to describe the prior parameter distribution of categorical/multinomial distributions. Dirichlet distributions are defined by a list of _alpha_ values (one for each dimension).  For instance, the 3-dimensional distribution _Dirichlet(1,1,2)_ is expressed as:
{{{
<variable id="dirichlet_example">
<alpha>1</alpha>
<alpha>1</alpha>
<alpha>2</alpha>
</variable>
}}}


== 4. Models ==

A dialogue model is essentially defined as a set of probabilistic rules combined with one or more "trigger variables" that defines when the rules are to be applied:
{{{
<model trigger="trigger variable(s)">

 <rule id="rule 1">
      ...
 </rule>

 <rule id="rule 2">
      ...
 </rule>

 ...

 <rule id="rule n">
      ...
 </rule>

</model>
}}}

The rules can either encode probability or utility rules, as explained below (also see [http://folk.uio.no/plison/pdfs/thesis/thesis-plison2013.pdf my Ph.D. thesis] for more explanations).

=== Probability rules ===

Probability rules express how a subset of state variables (the "input variables" of the rule) affect the probability distribution over some other state variables (the "output variables").  Probability rules are structured as an *if...then...else* construction:
{{{
if (condition c1) then
  P(effect e1) = ...  
  P(effect e2) = ...
  ...
else if (condition c2) then
  P(effect e3) = ...
  ....
...
else
  P(effect m) = ...
}}}

Probability rules are expressed in XML as (ordered) list of cases.  Each case has a (possibly empty) condition and a list of alternative effects (each with a particular probability). 

Here two concrete examples of probability rules (corresponding to rules r,,5,, and r,,6,, in [http://folk.uio.no/plison/pdfs/thesis/thesis-plison2013.pdf my Ph.D. thesis]):
{{{
<rule id="r5">
  <case>
    <condition operator="or">
      <if var="B" relation="=" value="b1"/>
      <if var="C" relation="=" value="b1"/>
    </condition>
    <effect prob="0.6">
      <set var="A" value="a1"/>
    </effect>
  </case>
  <case>
    <condition>
      <if var="C" relation="=" value="c2"/>
    </condition>
    <effect prob="0.3">
      <set var="A" value="a1"/>
    </effect>
    <effect prob="0.7">
      <set var="A" value="a2"/>
    </effect>
   </case>
</rule>

<rule id="r6">
  <case>
    <condition operator="and">
      <if var="C" relation="=" value="c1"/>
      <if var="D"  relation="!=" value="b1"/>
    </condition>
    <effect prob="0.9">
      <set var="A" value="a2"/>
      <set var="E" value="e2"/>
    </effect>
    <effect prob="0.1">
      <set var="A" value="a2"/>
      <set var="E" value="e1"/>
    </effect>
  </case>
  <case>
    <condition>
      <if var="C" relation="=" value="c2"/>
    </condition>
    <effect prob="0.5">
      <set var="E" value="e2"/>
    </effect>
   </case>
</rule>
}}}

We now detail how the conditions and effects are practically specified.

==== Conditions ====

As exemplified in the rules above, the `condition` XML node is composed of a list of basic conditions.  Each basic condition is written as an `<if ...>` tag with three attributes:
|| `var` || Obligatory || The variable label ||
|| `relation` || Optional ||  Binary relation to satisfy.  Admissible relations are `=` (equality), `!=` (inequality), `<` (lower than),<br> `>` (higher than) and `in` (contains).  Default relation is equality. ||
|| `value` || Obligatory || The variable value to check ||

The basic conditions are linked together with either a conjunction (`and`) or a disjunction (`or`).  Default value is a conjunction.`[2]`

==== Effects ====




=== Utility rules ===

=== Quantification ===


== 5. Settings ==


----

`[1]` Multivariate Gaussian distributions can also be defined.  In this case, the scalar values for the mean and variance are replaced by vector values in the form `<mean>[v1,v2,..,vn]</mean`.  Multivariate Gaussian distributions support for the moment only distributions with a diagonal covariance (i.e. independent Gaussians).

`[2]` If needed, one can also define more advanced, nested conditions, such as for instance A=a1 *and* *not*(B=b1 *or* C!=c1):
{{{
<condition>
  <if var="A" relation="=" value="a1"/>
  <not>
    <or>
      <if var="B" relation="=" value="b1"/>
      <if var="C" relation="!=" value="c1"/>
    </or>
  </not>
</condition>
}}}